@using SubsidizedDutyMeal.Models
@using System.Web.Mvc.Html


@{
    ViewBag.Title = "Index";
}

<style>
    tfoot input {
        width: 100%;
        padding: 3px;
        box-sizing: border-box;
    }

    #tbl_filter {
        display: none;
    }

    .modal-md {
        max-width: 50% !important;
    }
    #tblFeedback td {
        padding:5px!important;
    }
    #tblFeedback th {
        background-color: #1dc4d8;
        color: white;
    }
    #tblFeedback tr td:first-child {
        padding-left: 20px!important;
    }
    #tblFeedback tr td:nth-child(3) {
        padding-right: 20px !important;
    }
</style>

@{


    List<SelectListItem> listRate = new List<SelectListItem>();
    listRate.Add(new SelectListItem{Text = "Excellent",Value = "5",});
    listRate.Add(new SelectListItem { Text = "Good", Value = "4", });
    listRate.Add(new SelectListItem { Text = "Fair", Value = "3", });
    listRate.Add(new SelectListItem { Text = "Poor", Value = "2", });
    listRate.Add(new SelectListItem { Text = "Failed", Value = "1", });



}

<script src="~/Content/scripts/moment.js"></script>
<div class="modal fade" id="modalFeedbacks" lass="modal hide" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            @*<div style="text-align:right!important;vertical-align: middle!important;padding-top:20px;padding-right:20px;">

                <img src="~/Images/Assets/feedback2.png" style="width:180px;height:100px;" />
               

            </div>*@
            <div class="row col-md-12">
                <div class="col-md-6" style="margin-top: 40px!important;">
                    <h4 style="margin-left:20px;font-size: 1.2rem;font-weight: 500;">Fill all details</h4>
                </div>
                <div class="col-md-6 " style="text-align:right;margin-top: 10px!important;">
                    <img src="/Images/Assets/feedback2.png" style="width:180px;height:80px;">
                </div>
            </div>
            <div class="modal-body">
                <div class="alert alert-success" id="alertbox" style="display: none; font-size:14px;">
                    <strong>Success!</strong> Data posted.
                </div>
                <div class="alert alert-danger" id="alertbox2" style="display: none; font-size:14px;">
                    <strong>Error!</strong><p id="msg"></p>
                </div>


                @using (Html.BeginForm(null, null, FormMethod.Post, new { enctype = "multipart/form-data", id = "frm" }))
                {
                    <input type="text" class="form-control" name="ID" id="ID" hidden>
                    <table id="tblFeedback" class="table table-striped table-bordered"  style="background-color:white">
                        <tbody>
                            <tr>
                                <th>Quality of Food</th>
                                <th>Rate</th>
                                <th>Remarks</th>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Taste</label></td>
                                <td>@Html.DropDownList("Taste", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="TasteRemarks" id="TasteRemarks" /></td>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Nutrition Value</label></td>
                                <td>@Html.DropDownList("NutritionalValue", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="NutritionalValueRemarks" id="NutritionalValueRemarks" /></td>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Presentation/Appearance</label></td>
                                <td>@Html.DropDownList("PresentationAppearance", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="PresentationAppearanceRemarks" id="PresentationAppearanceRemarks" /></td>
                            </tr>
                            <tr>
                                <th>Quality of Service (Quality of service at the counter)</th>
                                <th>Rate</th>
                                <th>Remarks</th>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Attentiveness</label></td>
                                <td>@Html.DropDownList("Attentiveness", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="AttentivenessRemarks" id="AttentivenessRemarks" /></td>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Courtesy</label></td>
                                <td>@Html.DropDownList("Courtesy", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="CourtesyRemarks" id="CourtesyRemarks" /></td>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Speed</label></td>
                                <td>@Html.DropDownList("Speed", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="SpeedRemarks" id="SpeedRemarks" /></td>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Appearance</label></td>
                                <td>@Html.DropDownList("Appearance", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="AppearanceRemarks" id="AppearanceRemarks" /></td>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Overall Service</label></td>
                                <td>@Html.DropDownList("OverallService", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="OverallServiceRemarks" id="OverallServiceRemarks" /></td>
                            </tr>
                            <tr>
                                <th>Quality of Cleanliness</th>
                                <th>Rate</th>
                                <th>Remarks</th>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Utensils</label></td>
                                <td>@Html.DropDownList("Utensils", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="UtensilsRemarks" id="UtensilsRemarks" /></td>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Tables Chairs</label></td>
                                <td>@Html.DropDownList("TablesChairs", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="TablesChairsRemarks" id="TablesChairsRemarks" /></td>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Floor</label></td>
                                <td>@Html.DropDownList("Floor", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="FloorRemarks" id="FloorRemarks" /></td>
                            </tr>
                            <tr>
                                <td><label class="col-form-label">Ambiance</label></td>
                                <td>@Html.DropDownList("Ambiance", listRate, "Select Rate", new { @class = "form-control form-control-md" })</td>
                                <td><input placeholder="Enter Remarks" class="form-control form-control-md" name="AmbianceRemarks" id="AmbianceRemarks" /></td>
                            </tr>
                            <tr>
                                <td ><label class="col-form-label">Comment</label></td>
                                <td colspan="2"><textarea rows="3" placeholder="Enter Comments" class="form-control form-control-md" name="Comments" id="Comments"></textarea> </td>
                               
                            </tr>
                        </tbody>
                    </table>
                }
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" onClick="reload();">Close</button>
                <button type="button" class="btn btn-primary" id="btnSubmit">Submit</button>
            </div>
        </div>
    </div>
</div>





<div class="card">

    <div class="card-body">
        <div class="form-group row">
            <img src="~/Images/Assets/feedback3.png" style="width:70px;height:60px;" />
            <h4 class="card-title" style="margin-top: 20px;">Feedbacks List</h4>
        </div>
        

        <div class="row form-group">
            <input style="margin-right:5px;" placeholder="Enter Employee ID" type="text" id="EmpID" class="numericOnly form-control col-sm-3" />

            <button class="btn btn-success mr-2" id="btnCreate">
                Create Feedback
                <i class="mdi mdi-plus"></i>
            </button>
        </div>
        <div class="row form-group">
            <input readonly placeholder="Employee Name" type="text" id="EmpName" class="numericOnly form-control col-sm-3" />
        </div>


        <table id="tbl" class="table table-striped table-bordered dataTable" style="width: 100%">
            <thead>
                <tr>

                    <th>Date Created</th>
                    <th>Name</th>

                    <th>Action</th>
                </tr>
                <tr>

                    <th>Date Created</th>
                    <th>Name</th>

                    <th></th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <th>Date Created</th>
                    <th>Name</th>

                    <th></th>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<script>
    var $ttype = "new";
    $(function () {
        $("#datepicker").datepicker();


    });
    function clear() {
        $("#ID").val(0);
       

        $("#Taste").val(3);
        $("#TasteRemarks").val("");
        $("#NutritionalValue").val(3);
        $("#NutritionalValueRemarks").val("");
        $("#PresentationAppearance").val(3);
        $("#PresentationAppearanceRemarks").val("");
        $("#Attentiveness").val(3);
        $("#AttentivenessRemarks").val("");
        $("#Courtesy").val(3);
        $("#CourtesyRemarks").val("");
        $("#Speed").val(3);
        $("#SpeedRemarks").val("");
        $("#Appearance").val(3);
        $("#AppearanceRemarks").val("");
        $("#OverallService").val(3);
        $("#OverallServiceRemarks").val("");
        $("#Utensils").val(3);
        $("#UtensilsRemarks").val("");
        $("#TablesChairs").val(3);
        $("#TablesChairsRemarks").val("");
        $("#Floor").val(3);
        $("#FloorRemarks").val("");
        $("#Ambiance").val(3);
        $("#AmbianceRemarks").val("");
        $("#Comments").val("");
        $("#alertbox2")[0].style.display = "none";

        $("#alertbox")[0].style.display = "none";

    }

    $('#btnCreate').click(function () {
        clear();
        $ttype = "new";

        var parsed = isNaN(parseInt($('#EmpID').val()));

        if (parsed) {
            alert("Fill out Employee ID box");
            $('#EmpID').focus();
            return;
        } else {

            $.ajax({
                url: "@Url.Action("GetEmployeeDetails")"
                , method: "POST"
                , dataType: 'json'
                , data: {
                    EmpID: $('#EmpID').val()
                }
                , success: function (responsedata) {
                    if (responsedata.status == "success") {
                        $('#tbl').DataTable().ajax.reload();

                        $('#EmpID').focus().select();
                        $('#modalFeedbacks').modal('show');


                    } else {

                        swal("Fail!", "Employee ID does not exist!", {
                            buttons: false,
                            timer: 2000
                        }).then(function () {
                            $('#EmpID').focus().select();
                        })


                    }
                }
            });

        }
    });





    $('#tbl thead tr:eq(1) th').each(function () {
        var title = $(this).text();

        if (title === "Date Created") {
            $(this).html('<input type="text" class="form-control form-control-md" id="datepicker" placeholder="Search ' + title + '" />');
        } else {
            $(this).html('<input type="text" class="form-control form-control-md" placeholder="Search ' + title + '" />');
        }

    });
    $('#btnSubmit').click(function () {

        
         $.ajax({
             url: "@Url.Action("CreateUpdateFeedback")?Ttype=" + $ttype + "&EmployeeID=" + $('#EmpID').val() 
                , method: "POST"
                , dataType: 'json'
                , data: $('#frm').serialize()
                , success: function (responsedata) {
                    if (responsedata.status == "success") {
                        $("#alertbox2")[0].style.display = "none";

                        $("#alertbox")[0].style.display = "block";

                    } else {
                        document.getElementById('msg').innerHTML = responsedata.message;
                        $("#alertbox")[0].style.display = "none";
                        $("#alertbox2")[0].style.display = "block";

                        //swal("Error!" + responsedata.message, "Please try again", "error");
                    }
                }
            });
    });
    function reload() {
        $('#tbl').DataTable().ajax.reload();
    }


    function modalFeedbacks(v) {
        clear();
            var $buttonClicked = $(v);
            var id = parseInt($buttonClicked.attr('data-id'))||0;
            $('#detailID').val(id);
            $ttype = "update";

                    $.ajax({
                        url: "@Url.Action("ShowDetails")"
                            , method: "POST"
                            , dataType: 'json'
                            , data: { id: id}
                            , success: function (responsedata) {

                                if (responsedata.status == "success") {
                                    $("#Code").val(responsedata.param1);
                                    $("#Name").val(responsedata.param2);
                                } else {
                                swal("Error!" + responsedata.message, "Please try again", "error");
                                }

                            }
                    });

        $('#modalFeedbacks').modal('show');
        }



    var table = $('#tbl').DataTable({
        "processing": true,
        "serverSide": true,
        "info": true,
        "lengthMenu": [[50, 100, 150, -1], [50, 100, 150, "All"]],
        "ajax": {


            "url": "@Url.Action("getDataFeedback", "Order")",
            "type": "POST",
            "data": function (d) {
                d.noCols = 2,
                d.empid = $('#EmpID').val();
            }

        },
        "dom": "Bfrtip",
        "columns": [



            {
                "data": "DateCreated"
                , "orderable": true
                , "render": function (data, type, row, meta, value) {
                    if (value === null) return "";
                    var $newLinkTarget = '<a href="#" onclick="modalData(this);" data-id=' + row['ID'] + '>' + moment(data).format('dddd ll') + ' </a>';
                    //var $newLinkTarget = '<a href="@Url.Action("Details")?id='+row['ID']+ '">' + moment(data).format('dddd ll') + ' </a>';
                    return $newLinkTarget;
                }
                , "width": "20%"
            },
            {
                "data": "Name"
                , "orderable": true
                , "width": "70%"
            },

            {
                "data": "ID"
                , "orderable": false
                , "width": "10px"
                , "render": function (data, type, row, meta) {

                    var $newLinkTarget = '<a href="javascript:deleteItemdetail(' + row['ID'] + ')"><i class="menu-icon mdi mdi-delete"></i></a>';


                    return $newLinkTarget;
                }, "visible": true
            }



        ],
        "order": [[0, "asc"]]
            , "orderCellsTop": true
    });

    function modalData(v) {
            clear();
            var $buttonClicked = $(v);
            var id = parseInt($buttonClicked.attr('data-id'))||0;
            $('#detailID').val(id);
            $ttype = "update";

                    $.ajax({
                        url: "@Url.Action("ShowDetailsFeedback")"
                            , method: "POST"
                            , dataType: 'json'
                            , data: { id: id}
                            , success: function (responsedata) {

                                if (responsedata.status == "success") {
                                    console.log(responsedata.data[0].TasteRemarks);
                                    $("#ID").val(responsedata.data[0].ID);

                                    $("#EmployeeID").val(responsedata.data[0].EmployeeID);
                                    $("#Taste").val(responsedata.data[0].Taste);
                                    $("#TasteRemarks").val(responsedata.data[0].TasteRemarks);
                                    $("#NutritionalValue").val(responsedata.data[0].NutritionalValue);
                                    $("#NutritionalValueRemarks").val(responsedata.data[0].NutritionalValueRemarks);
                                    $("#PresentationAppearance").val(responsedata.data[0].PresentationAppearance);
                                    $("#PresentationAppearanceRemarks").val(responsedata.data[0].PresentationAppearanceRemarks);
                                    $("#Attentiveness").val(responsedata.data[0].Attentiveness);
                                    $("#AttentivenessRemarks").val(responsedata.data[0].AttentivenessRemarks);
                                    $("#Courtesy").val(responsedata.data[0].Courtesy);
                                    $("#CourtesyRemarks").val(responsedata.data[0].CourtesyRemarks);
                                    $("#Speed").val(responsedata.data[0].Speed);
                                    $("#SpeedRemarks").val(responsedata.data[0].SpeedRemarks);
                                    $("#Appearance").val(responsedata.data[0].Appearance);
                                    $("#AppearanceRemarks").val(responsedata.data[0].AppearanceRemarks);
                                    $("#OverallService").val(responsedata.data[0].OverallService);
                                    $("#OverallServiceRemarks").val(responsedata.data[0].OverallServiceRemarks);
                                    $("#Utensils").val(responsedata.data[0].Utensils);
                                    $("#UtensilsRemarks").val(responsedata.data[0].UtensilsRemarks);
                                    $("#TablesChairs").val(responsedata.data[0].TablesChairs);
                                    $("#TablesChairsRemarks").val(responsedata.data[0].TablesChairsRemarks);
                                    $("#Floor").val(responsedata.data[0].Floor);
                                    $("#FloorRemarks").val(responsedata.data[0].FloorRemarks);
                                    $("#Ambiance").val(responsedata.data[0].Ambiance);
                                    $("#AmbianceRemarks").val(responsedata.data[0].AmbianceRemarks);
                                    $("#Comments").val(responsedata.data[0].Comments);

                                } else {
                                    swal("Error!" + responsedata.message, "Please try again", "error");
                                }

                            }
                    });

        $('#modalFeedbacks').modal('show');
        }



            $(window).resize(function () {
                table.fnDraw(false)
            });

            // Apply the search
            var delay = (function () {
                var timer = 0;
                return function (callback, ms) {
                    clearTimeout(timer);
                    timer = setTimeout(callback, ms);
                };
            })();

            $('#tbl input').on('keyup change', function (e) {
                var keyCode = e.keyCode
                if (keyCode >= 9 && keyCode <= 27) {

                } else {
                    searchFunction(this);
                }
            });
            function searchFunction(e) {
                delay(function () {

                    table.column($(e).parent().index() + ':visible')
                    .search(e.value)
                    .draw();
                }, 1000);
    }

    function deleteItemdetail(id) {
            swal({
            title: "Are you sure you want to delete item?",
                text: "Once deleted, you will not be able to recover this file!",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        }).then((willDelete) => {
            if (willDelete) {
                 $.post("@Url.Action("DeleteFeedback")", {id:id}
                       , function (responseData) {
                           if (responseData.status == "success") {
                               swal("Done!", "It was succesfully deleted!", {
                                   icon: "success",
                               });
                               $('#tbl').DataTable().ajax.reload();
                           } else {
                               swal("Error deleting!", "Please try again", "error");
                           }
                       });
            } else {
               swal("Transaction cancelled!");
            }
            });






    }
    $('#EmpID').on('keyup', function (event) {

        event.preventDefault();
        if (event.keyCode === 13) {
            $('#tbl').DataTable().ajax.reload();
        }

    });



</script>







